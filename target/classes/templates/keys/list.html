<!doctype html><html lang="ru" xmlns:th="http://www.thymeleaf.org"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>License Server ‚Äî –ö–ª—é—á–∏</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="/css/custom.css" rel="stylesheet"></head>
<body class="bg-dark text-light"><nav class="navbar navbar-expand-lg navbar-dark bg-black border-bottom border-secondary">
<div class="container-fluid"><a class="navbar-brand fw-bold" href="/admin">üîê License Server</a>
<div class="collapse navbar-collapse"><ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link active" href="/admin/keys">–ö–ª—é—á–∏</a></li></ul>
<a class="btn btn-outline-light btn-sm" href="/logout">–í—ã–π—Ç–∏</a></div></div></nav>
<main class="container py-4">

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">–ö–ª—é—á–∏</h2>
  <div class="d-flex gap-2">
    <a href="/admin/keys/new" class="btn btn-primary">‚ûï –ù–æ–≤—ã–π –∫–ª—é—á</a>
  </div>
</div>

<form id="bulkForm" method="post" action="/admin/keys/bulk">
  <input type="hidden" name="action" id="bulkAction" value="">
  <div class="mb-2 d-flex gap-2">
    <button type="submit" class="btn btn-warning btn-sm" onclick="setAction('reset')">–°–±—Ä–æ—Å–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirmBulk('–í—ã–≥–Ω–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∏ —É–¥–∞–ª–∏—Ç—å –∫–ª—é—á–∏?') && setAction('kick')">–í—ã–≥–Ω–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
    <button type="submit" class="btn btn-outline-light btn-sm" onclick="return confirmBulk('–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏?') && setAction('delete')">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</button>
    <button type="submit" class="btn btn-success btn-sm" onclick="setAction('export')">–°–∫–∞—á–∞—Ç—å .txt</button>
  </div>

  <div class="table-responsive"><table class="table table-dark table-striped align-middle">
  <thead>
    <tr>
      <th style="width:34px;"><input type="checkbox" id="checkAll"></th>
      <th>ID</th><th>–ö–ª—é—á</th><th>MAC</th><th>–°—Ç–∞—Ç—É—Å</th><th>–°–æ–∑–¥–∞–Ω</th><th>–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</th><th>–¢–µ–ª–µ–≥—Ä–∞–º —é–∑–µ—Ä</th>
      <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>
  <tbody>
  <tr th:each="k : ${items}">
    <td><input type="checkbox" class="row-check" name="ids" th:value="${k.id}"></td>
    <td th:text="${k.id}">1</td>
    <td><code th:text="${k.licenseKey}">KEY</code></td>
    <td><code th:text="${#strings.isEmpty(k.boundMac) ? '-' : k.boundMac}">-</code></td>
    <td><span class="badge" th:classappend="${k.status.name()=='ACTIVE'} ? ' text-bg-success' : ' text-bg-danger'" th:text="${k.status}">ACTIVE</span></td>
    <td th:text="${k.createdAt != null ? #temporals.format(k.createdAt, 'yyyy-MM-dd') : '-'}">-</td>
    <td th:text="${k.activatedAt != null ? #temporals.format(k.activatedAt, 'yyyy-MM-dd') : '-'}">-</td>
    <td th:text="${k.note}">-</td>
    <td class="text-end">
      <form th:action="@{'/admin/keys/' + ${k.id} + '/kick'}" method="post" class="d-inline" onsubmit="return confirm('–í—ã–≥–Ω–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–¥–∞–ª–∏—Ç—å –∫–ª—é—á? –ö–ª–∏–µ–Ω—Ç –∑–∞–∫—Ä–æ–µ—Ç—Å—è.');">
        <button class="btn btn-sm btn-danger">–í—ã–≥–Ω–∞—Ç—å</button>
      </form>
      <form th:action="@{'/admin/keys/' + ${k.id} + '/reset'}" method="post" class="d-inline">
        <button class="btn btn-sm btn-warning">–°–±—Ä–æ—Å–∏—Ç—å</button>
      </form>
      <form th:action="@{'/admin/keys/' + ${k.id} + '/delete'}" method="post" class="d-inline" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å –∫–ª—é—á?');">
        <button class="btn btn-sm btn-outline-light">–£–¥–∞–ª–∏—Ç—å</button>
      </form>
    </td>
  </tr>
  </tbody></table></div>
</form>

</main>
<script>
  const checkAll = document.getElementById('checkAll');
  const checks = () => Array.from(document.querySelectorAll('.row-check'));
  checkAll?.addEventListener('change', e => { checks().forEach(c => c.checked = e.target.checked); });
  function setAction(a){ document.getElementById('bulkAction').value = a; return true; }
  function confirmBulk(msg){ return confirm(msg); }
</script>
</body></html>
